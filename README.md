# Simple Forward Auth

–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–∏—Å **forward authentication**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –≤–∞—à–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–º. –û–Ω –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –æ–±—Ä–∞—Ç–Ω—ã–º–∏ –ø—Ä–æ–∫—Å–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ Caddy, Traefik –∏–ª–∏ Nginx.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ü—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞**: –ó–∞—â–∏—Ç–∞ –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∞–π—Ç–æ–≤ –æ–¥–Ω–∏–º —Ü–∏—Ñ—Ä–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º (PIN-–∫–æ–¥–æ–º).
- **–õ–µ–≥–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Docker**: –ì–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Docker-–æ–±—Ä–∞–∑.
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π UI**: –ü—Ä–∏—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –¥–ª–∏–Ω—É –≤–∞—à–µ–≥–æ –ø–∞—Ä–æ–ª—è.
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ cookie –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–∞—Ö –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞.

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### 1. docker-compose.yml

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```yaml
version: '3.8'

services:
  forward-auth:
    image: ghcr.io/webzaytsev/forward-auth:latest # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –æ–±—Ä–∞–∑
    build: . # –ò–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ
    container_name: forward-auth
    restart: unless-stopped
    environment:
      - AUTH_PASSWORD=1234
      - SESSION_SECRET=your-super-secret-key-32-bytes-long
      - AUTH_DOMAIN=https://auth.example.com
    networks:
      - proxy

networks:
  proxy:
    external: true
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏

–í–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–æ–º.

#### –ü—Ä–∏–º–µ—Ä –¥–ª—è Caddy (`Caddyfile`)

Caddy - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º HTTPS.

```caddy
# –î–æ–º–µ–Ω –¥–ª—è —Å–∞–º–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
auth.example.com {
    reverse_proxy forward-auth:8080
}

# –ü—Ä–∏–º–µ—Ä –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
app.example.com {
    forward_auth forward-auth:8080 {
        uri / # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —ç—Ç–æ–º—É —Å–∞–π—Ç—É
        copy_headers X-Forwarded-Proto X-Forwarded-Host X-Forwarded-Uri
    }
    
    # –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    reverse_proxy my-app:3000
}
```

- `auth.example.com` - —ç—Ç–æ –¥–æ–º–µ–Ω, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞. –û–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `AUTH_DOMAIN`.
- `app.example.com` - —ç—Ç–æ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞—â–∏—Ç–∏—Ç—å. –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `forward_auth` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ —Å–µ—Ä–≤–∏—Å `forward-auth`.

### 3. –ó–∞–ø—É—Å–∫

1.  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —Å–æ–∑–¥–∞–Ω–∞ –≤–Ω–µ—à–Ω—è—è —Å–µ—Ç—å `proxy` –¥–ª—è Caddy (`docker network create proxy`).
2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:

```bash
docker-compose up -d
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ `app.example.com` –≤–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ `auth.example.com` –¥–ª—è –≤–≤–æ–¥–∞ PIN-–∫–æ–¥–∞. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è       | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                   | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                |
| ---------------- | ---------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `AUTH_PASSWORD`  | –¶–∏—Ñ—Ä–æ–≤–æ–π –ø–∞—Ä–æ–ª—å (PIN-–∫–æ–¥) –¥–ª—è –¥–æ—Å—Ç—É–ø–∞. –î–ª–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤.                              | `1234`                               |
| `SESSION_SECRET` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Å–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö cookie. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–º–∏–Ω–∏–º—É–º 32 –±–∞–π—Ç–∞)!** | `secret-key-32-bytes-long-minimum` |
| `AUTH_DOMAIN`    | –ü–æ–ª–Ω—ã–π URL-–∞–¥—Ä–µ—Å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ—Å—Ç—É–ø–µ–Ω —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://auth.example.com`).         | `http://auth.zaitsv.dev`             |

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –ª—é–±–æ–π –≤–∫–ª–∞–¥! –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∏–¥–µ–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∏–ª–∏ –≤—ã –Ω–∞—à–ª–∏ –æ—à–∏–±–∫—É, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ [issue](https://github.com/WEBzaytsev/forward-auth/issues) –∏–ª–∏ [pull request](https://github.com/WEBzaytsev/forward-auth/pulls). 